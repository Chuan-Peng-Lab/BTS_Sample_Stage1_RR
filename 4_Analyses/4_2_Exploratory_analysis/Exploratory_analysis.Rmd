---
title: "Exploratory_analysis"
author: "Weibiao Liu"
date: "2024/01/17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)        # ggplot, dplyr, %>%, and friends
library(brms)             # Bayesian modeling through Stan
library(marginaleffects)  # Calculate marginal effects for regression models
library(tidybayes)        # Manipulate Stan objects in a tidy way
library(patchwork)        # Combine ggplot objects
```

```{r}
set.seed(1234)  # Make everything reproducible

# Define the goodness-of-fit stats to include in modelsummary()
gof_stuff <- tribble(
  ~raw, ~clean, ~fmt,
  "nobs", "N", 0,
  "r.squared", "RÂ²", 3
)

# Custom ggplot theme to make pretty plots
# Get the font at https://fonts.google.com/specimen/Barlow+Semi+Condensed
theme_clean <- function() {
  theme_minimal(base_family = "Barlow Semi Condensed") +
    theme(panel.grid.minor = element_blank(),
          plot.title = element_text(family = "BarlowSemiCondensed-Bold"),
          axis.title = element_text(family = "BarlowSemiCondensed-Medium"),
          strip.text = element_text(family = "BarlowSemiCondensed-Bold",
                                    size = rel(1), hjust = 0),
          strip.background = element_rect(fill = "grey80", color = NA))
}

# Make labels use Barlow by default
update_geom_defaults("label_repel", list(family = "Barlow Semi Condensed"))

# Format things as percentage points
label_pp <- label_number(accuracy = 1, scale = 100, 
                         suffix = " pp.", style_negative = "minus")
label_pp_tiny <- label_number(accuracy = 0.01, scale = 100, 
                              suffix = " pp.", style_negative = "minus")


```

######1.Country-level relationship between proportion of sample and socioeconomic/cultural factors for traditional studies (using PS2014 as an example) and big team science (using PSA 001 as an example)

####_1.1GDP_per_capita
```{r}
gdpdata <- read_csv("gdpdata.csv")
gdpdata
```

##BTS
```{r}
gdp_model_beta_zi_bts <- brms::brm(
   bf(bts| trials(total_bts) ~ GDP_per_capita,
   phi ~ GDP_per_capita,
     zi ~ GDP_per_capita),
  data = gdpdata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "gdp_model_beta_zi_bts"
)
tidy(gdp_model_beta_zi_bts, effects = "fixed")

```

```{r}
ame_beta_zi_gdp_bts <- gdp_model_beta_zi_bts %>%
  marginaleffects::avg_comparisons(variables = "GDP_per_capita") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_gdp_bts %>% tidybayes::median_hdi(draw)

result <-  brms::hypothesis(ame_beta_zi_gdp_bts, "draw>0")
result
ggplot2::ggplot(ame_beta_zi_gdp_bts, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of GDP per capita", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##PS2014
```{r}
gdp_model_beta_zi_ps2014 <- brms::brm(
  bf(ps| trials(total_ps) ~ GDP_per_capita,
   phi ~ GDP_per_capita,
     zi ~ GDP_per_capita),
  data = gdpdata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 4, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "gdp_model_beta_zi_ps2014"
)
tidy(gdp_model_beta_zi_ps2014, effects = "fixed")
```

```{r}
ame_beta_zi_gdp_ps2014 <- gdp_model_beta_zi_ps2014 %>%
  marginaleffects::avg_comparisons(variables = "GDP_per_capita") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_gdp_ps2014 %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_gdp_ps2014, "draw>0")
result
ggplot(ame_beta_zi_gdp_ps2014, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of GDP per capita", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```


##1.2_R&D_investment
```{r}
rddata <- read_csv("rddata.csv")
rddata
```

##BTS
```{r}
rd_model_beta_zi_bts <- brms::brm(
  bf(bts| trials(total_bts) ~ R_D,
   phi ~ R_D,
     zi ~ R_D),
  data = rddata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "rd_model_beta_zi_bts"
)
tidy(rd_model_beta_zi_bts, effects = "fixed")

```

```{r}
ame_beta_zi_rd_bts <- rd_model_beta_zi_bts %>%
  marginaleffects::avg_comparisons(variables = "R_D") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_rd_bts %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_rd_bts, "draw>0")
result

ggplot(ame_beta_zi_rd_bts, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of R&D investment", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##PS2014
```{r}
rd_model_beta_zi_ps2014 <- brms::brm(
  bf(ps| trials(total_ps) ~ R_D,
   phi ~ R_D,
     zi ~ R_D),
  data = rddata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "rd_model_beta_zi_ps2014"
)
tidy(rd_model_beta_zi_ps2014, effects = "fixed")
```

```{r}
ame_beta_zi_rd_ps2014 <- rd_model_beta_zi_ps2014 %>%
  marginaleffects::avg_comparisons(variables = "R_D") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_rd_ps2014 %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_rd_ps2014, "draw>0")
result
ggplot(ame_beta_zi_rd_ps2014, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of R&D investment", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```


##1.3_Number of universities per 100000 people
```{r}
universitydata <- read_csv("universitydata.csv")
universitydata
```

##BTS
```{r}
university_model_beta_zi_bts <- brms::brm(
  bf(bts| trials(total_bts) ~ number_of_universities_per_capita,
   phi ~ number_of_universities_per_capita,
     zi ~ number_of_universities_per_capita),
  data = universitydata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "university_model_beta_zi_bts"
)
tidy(university_model_beta_zi_bts, effects = "fixed")
```

```{r}
ame_beta_zi_university_bts <- university_model_beta_zi_bts %>%
  marginaleffects::avg_comparisons(variables = "number_of_universities_per_capita") %>% 
  marginaleffects::posterior_draws()

ame_beta_zi_university_bts %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_university_bts, "draw>0")
result

ggplot(ame_beta_zi_university_bts, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Number of universities per 100000 people", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##PS2014
```{r}
university_model_beta_zi_ps2014 <- brms::brm(
  bf(ps| trials(total_ps) ~ number_of_universities_per_capita,
   phi ~ number_of_universities_per_capita,
     zi ~ number_of_universities_per_capita),
  data = universitydata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "university_model_beta_zi_ps2014"
)
tidy(university_model_beta_zi_ps2014, effects = "fixed")

```

```{r}
ame_beta_zi_university_ps2014 <- university_model_beta_zi_ps2014 %>%
  marginaleffects::avg_comparisons(variables = "number_of_universities_per_capita") %>% 
  marginaleffects::posterior_draws()

ame_beta_zi_university_ps2014 %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_university_ps2014, "draw>0")
result

ggplot(ame_beta_zi_university_ps2014, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Number of universities per 100000 people", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```


##number_of_psychology_researchers_per_capita
```{r}
researcherdata <- read_csv("researcherdata.csv")
researcherdata
```

##BTS
```{r}
researcher_model_beta_zi_bts <- brms::brm(
  bf(bts| trials(total_bts) ~ number_of_psychology_researchers_per_capita,
   phi ~ number_of_psychology_researchers_per_capita,
     zi ~ number_of_psychology_researchers_per_capita),
  data = researcherdata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "researcher_model_beta_zi_bts"
)
tidy(researcher_model_beta_zi_bts, effects = "fixed")

```

```{r}
ame_beta_zi_researcher_bts <- researcher_model_beta_zi_bts %>%
  marginaleffects::avg_comparisons(variables = "number_of_psychology_researchers_per_capita") %>% 
  marginaleffects::posterior_draws()

ame_beta_zi_researcher_bts %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_researcher_bts, "draw>0")
result

ggplot(ame_beta_zi_researcher_bts, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of number of psychology researchers per capita", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##PS2014
```{r}
researcher_model_beta_zi_ps2014 <- brms::brm(
  bf(ps| trials(total_ps) ~ number_of_psychology_researchers_per_capita,
   phi ~ number_of_psychology_researchers_per_capita,
     zi ~ number_of_psychology_researchers_per_capita),
  data = researcherdata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "researcher_model_beta_zi_ps2014"
)
tidy(researcher_model_beta_zi_ps2014, effects = "fixed")

```

```{r}
ame_beta_zi_researcher_ps2014 <- researcher_model_beta_zi_ps2014 %>%
  marginaleffects::avg_comparisons(variables = "number_of_psychology_researchers_per_capita") %>% 
  marginaleffects::posterior_draws()

ame_beta_zi_researcher_ps2014 %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_researcher_ps2014, "draw>0")
result

ggplot(ame_beta_zi_researcher_ps2014, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of number of psychology researchers per capita", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```



##_1.5_average_years_of_schooling
```{r}
edudata <- read_csv("Education_data.csv")
edudata
```

```{r}
edu_model_beta_zi_bts <- brms::brm(
   bf(bts| trials(total_bts) ~ average_years_of_schooling,
   phi ~ average_years_of_schooling,
     zi ~ average_years_of_schooling),
  data = edudata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "edu_model_beta_zi_bts"
)
tidy(edu_model_beta_zi_bts, effects = "fixed")
```

```{r}
ame_beta_zi_edu_bts <- edu_model_beta_zi_bts %>%
  marginaleffects::avg_comparisons(variables = "average_years_of_schooling") %>% 
  marginaleffects::posterior_draws()

ame_beta_zi_edu_bts %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_edu_bts, "draw>0")
result

ggplot(ame_beta_zi_edu_bts, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Average years of schooling", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##PS2014
```{r}
edu_model_beta_zi_ps2014 <- brms::brm(
  bf(ps| trials(total_ps) ~ average_years_of_schooling,
   phi ~ average_years_of_schooling,
     zi ~ average_years_of_schooling),
  data = edudata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "edu_model_beta_zi_ps2014"
)
tidy(edu_model_beta_zi_ps2014, effects = "fixed")
```


```{r}
ame_beta_zi_edu_ps2014 <- edu_model_beta_zi_ps2014 %>%
  marginaleffects::avg_comparisons(variables = "average_years_of_schooling") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_edu_ps2014 %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_edu_ps2014, "draw>0")
result

ggplot(ame_beta_zi_edu_ps2014, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Average years of schooling", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```


##1.6_Urbanization
```{r}
urbandata <- read_csv("Urbanization_data.csv")
urbandata
```

##BTS
```{r}
urban_model_beta_zi_bts <- brms::brm(
  bf(bts| trials(total_bts) ~ Urbanization,
   phi ~ Urbanization,
     zi ~ Urbanization),
  data = urbandata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "urban_model_beta_zi_bts")
tidy(urban_model_beta_zi_bts, effects = "fixed")

```

```{r}
ame_beta_zi_urban_bts <- urban_model_beta_zi_bts %>%
  marginaleffects::avg_comparisons(variables = "Urbanization") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_urban_bts %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_urban_bts, "draw>0")
result

ggplot(ame_beta_zi_urban_bts, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Urbanization", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##PS2014
```{r}
urban_model_beta_zi_ps2014 <- brms::brm(
  bf(ps| trials(total_ps) ~ Urbanization,
   phi ~ Urbanization,
     zi ~ Urbanization),
  data = urbandata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "urban_model_beta_zi_ps2014"
)
tidy(urban_model_beta_zi_ps2014, effects = "fixed")
```


```{r}
ame_beta_zi_urban_ps2014 <- urban_model_beta_zi_ps2014 %>%
  marginaleffects::avg_comparisons(variables = "Urbanization") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_urban_ps2014 %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_urban_ps2014, "draw>0")
result

ggplot(ame_beta_zi_urban_ps2014, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Urbanization", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```


##1.7_Globalization
```{r}
gidata <- read_csv("gidata.csv")
gidata
```

##BTS
```{r}
gi_model_beta_zi_bts <- brms::brm(
   bf(bts| trials(total_bts) ~ GI,
   phi ~ GI,
     zi ~ GI),
  data = gidata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "gi_model_beta_zi_bts"
)
tidy(gi_model_beta_zi_bts, effects = "fixed")

```

```{r}
ame_beta_zi_gi_bts <- gi_model_beta_zi_bts %>%
  marginaleffects::avg_comparisons(variables = "GI") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_gi_bts %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_gi_bts, "draw>0")
result

ggplot(ame_beta_zi_gi_bts, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Globalization", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##PS2014
```{r}
gi_model_beta_zi_ps2014 <- brms::brm(
  bf(ps| trials(total_ps) ~ GI,
   phi ~ GI,
     zi ~ GI),
  data = gidata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "gi_model_beta_zi_ps2014"
)
tidy(gi_model_beta_zi_ps2014, effects = "fixed")
```


```{r}
ame_beta_zi_gi_ps2014 <- gi_model_beta_zi_ps2014 %>%
  marginaleffects::avg_comparisons(variables = "GI") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_gi_ps2014 %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_gi_ps2014, "draw>0")
result

ggplot(ame_beta_zi_gi_ps2014, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Globalization", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```


##1.8_Internet penetration rate
```{r}
networkdata <- read_csv("networkdata.csv")
networkdata
```

##BTS
```{r}
network_model_beta_zi_bts <- brms::brm(
   bf(bts| trials(total_bts) ~ Network_2021,
   phi ~ Network_2021,
     zi ~ Network_2021),
  data = networkdata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "network_model_beta_zi_bts"
)
tidy(network_model_beta_zi_bts, effects = "fixed")

```

```{r}
ame_beta_zi_network_bts <- network_model_beta_zi_bts %>%
  marginaleffects::avg_comparisons(variables = "Network_2021") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_network_bts %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_network_bts, "draw>0")
result

ggplot(ame_beta_zi_network_bts, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Internet penetration rate", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```


##PS2014
```{r}
network_model_beta_zi_ps2014 <- brms::brm(
 bf(ps| trials(total_ps) ~ Network_2021,
   phi ~ Network_2021,
     zi ~ Network_2021),
  data = networkdata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "network_model_beta_zi_ps2014"
)
tidy(network_model_beta_zi_ps2014, effects = "fixed")
```

```{r}
ame_beta_zi_network_ps2014 <- network_model_beta_zi_ps2014 %>%
  marginaleffects::avg_comparisons(variables = "Network_2021") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_network_ps2014 %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_network_ps2014, "draw>0")
result

ggplot(ame_beta_zi_network_ps2014, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Internet penetration rate", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```


####1.9_cultural distance
```{r}
pddata <- read_csv("pddata.csv")
pddata
```

##BTS
```{r}
pd_model_beta_zi_bts <- brms::brm(
 bf(bts| trials(total_bts) ~ pd,
   phi ~ pd,
     zi ~ pd),
  data = pddata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "pd_model_beta_zi_bts"
)
tidy(pd_model_beta_zi_bts, effects = "fixed")
```

```{r}
ame_beta_zi_pd_bts <- pd_model_beta_zi_bts %>%
  marginaleffects::avg_comparisons(variables = "pd") %>%    marginaleffects::posterior_draws()
ame_beta_zi_pd_bts %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_pd_bts, "draw<0")
result

ggplot(ame_beta_zi_pd_bts, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Cultural distance", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

###PS2014
```{r}
pd_model_beta_zi_ps2014 <- brms::brm(
   bf(ps| trials(total_ps) ~ pd,
   phi ~ pd,
     zi ~ pd),
  data = pddata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 1000, warmup = 500,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "pd_model_beta_zi_ps2014"
)
tidy(pd_model_beta_zi_ps2014, effects = "fixed")

```

```{r}
ame_beta_zi_pd_ps2014 <- pd_model_beta_zi_ps2014 %>%
  marginaleffects::avg_comparisons(variables = "pd") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_pd_ps2014 %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_pd_ps2014, "draw<0")
result

ggplot(ame_beta_zi_pd_ps2014, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Cultural distance", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```


##1.10Linguistic distance
##lp1
```{r}
lddata <- read_csv("lddata.csv")
lddata
```

##BTS
```{r}
ld1_model_beta_zi_bts <- brms::brm(
  bf(bts| trials(total_bts) ~ lp1,
   phi ~ lp1,
     zi ~ lp1),
  data = lddata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "ld1_model_beta_zi_bts"
)
tidy(ld1_model_beta_zi_bts, effects = "fixed")
```

```{r}
ame_beta_zi_ld1_bts <- ld1_model_beta_zi_bts %>%
  marginaleffects::avg_comparisons(variables = "lp1") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_ld1_bts %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_ld1_bts, "draw<0")
result

ggplot(ame_beta_zi_ld1_bts, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Linguistic distance", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##PS2014
```{r}
ld1_model_beta_zi_ps2014 <- brms::brm(
  bf(ps| trials(total_ps) ~ lp1,
   phi ~ lp1,
     zi ~ lp1),
  data = lddata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "ld1_model_beta_zi_ps2014"
)
tidy(ld1_model_beta_zi_ps2014, effects = "fixed")
```


```{r}
ame_beta_zi_ld1_ps2014 <- ld1_model_beta_zi_ps2014 %>%
  marginaleffects::avg_comparisons(variables = "lp1") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_ld1_ps2014 %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_ld1_ps2014, "draw<0")
result

ggplot(ame_beta_zi_ld1_ps2014, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Linguistic distance", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```


##lp2
```{r}
ld2_model_beta_zi_bts <- brms::brm(
  bf(bts| trials(total_bts) ~ lp2,
   phi ~ lp2,
     zi ~ lp2),
  data = lddata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "ld2_model_beta_zi_bts"
)
tidy(ld2_model_beta_zi_bts, effects = "fixed")

```

```{r}
ame_beta_zi_ld2_bts <- ld2_model_beta_zi_bts %>%
  marginaleffects::avg_comparisons(variables = "lp2") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_ld2_bts %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_ld2_bts, "draw < 0")
result

ggplot(ame_beta_zi_ld2_bts, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Linguistic distance", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##ld2
##BTS
```{r}
ld2_model_beta_zi_ps2014 <- brms::brm(
  bf(ps| trials(total_ps) ~ lp2,
   phi ~ lp2,
     zi ~ lp2),
  data = lddata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
 control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "ld2_model_beta_zi_ps2014"
)
tidy(ld2_model_beta_zi_ps2014, effects = "fixed")
```


```{r}
ame_beta_zi_ld2_ps2014 <- ld2_model_beta_zi_ps2014 %>%
  marginaleffects::avg_comparisons(variables = "lp2") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_ld2_ps2014 %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_ld2_ps2014, "draw<0")
result

ggplot(ame_beta_zi_ld2_ps2014, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of Linguistic distance", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```


##_1.11English Proficiency rank
```{r}
englishdata <- read_csv("englishdata.csv")
englishdata
```

##BTS
```{r}
english_model_beta_zi_bts <- brms::brm(
  bf(bts| trials(total_bts) ~ EPI_rank,
   phi ~ EPI_rank,
     zi ~ EPI_rank),
  data = englishdata,
  family = zero_inflated_beta_binomial(),

  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "english_model_beta_zi_bts"
)
tidy(english_model_beta_zi_bts, effects = "fixed")

```

```{r}
ame_beta_zi_english_bts <- english_model_beta_zi_bts %>%
  marginaleffects::avg_comparisons(variables = "EPI_rank") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_english_bts %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_english_bts, "draw<0")
result

ggplot(ame_beta_zi_english_bts, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of English proficiency rank", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```


##PS2014
```{r}
english_model_beta_zi_ps2014 <- brms::brm(
  bf(ps| trials(total_ps) ~ EPI_rank,
   phi ~ EPI_rank,
     zi ~ EPI_rank),
  data = englishdata,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  # regularising priors
  prior = c(prior(normal(0, 1), class = Intercept),
            prior(normal(0, 1), class = b)),
  
  # tune the mcmc sampler
  control = list(adapt_delta = 0.99),
  
  backend = "cmdstanr",
  file = "english_model_beta_zi_ps2014"
)
tidy(english_model_beta_zi_ps2014, effects = "fixed")
```


```{r}
ame_beta_zi_english_ps2014 <- english_model_beta_zi_ps2014 %>%
  marginaleffects::avg_comparisons(variables = "EPI_rank") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_english_ps2014 %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_english_ps2014, "draw<0")
result

ggplot(ame_beta_zi_english_ps2014, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of English proficiency rank", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##GDP_per_capita drawing
```{r}  
combined_data2 <- rbind(
  transform(gdpdata, source = "PS2014", value = ps2014),
  transform(gdpdata, source = "PSA001", value = percentage_sample)
)
# Create the plot
gdp1 <- ggplot(combined_data2, aes(x = GDP_per_capita, y = value, color = source)) +
  
 geom_point(size = 6, alpha = 0.6) +
  geom_smooth(method ="lm",size = 2) +
  scale_color_brewer(palette = 'Set1') +
 scale_color_manual(name = "Data source", 
                    values = c("#377EB8","#E41A1C"), 
                    labels = c("Traditional studies", "Big team science"))+
  
  ylab("Proportion of sample") +
  xlab("GDP per capita") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1,
        legend.position = "right",  
        legend.text = element_text(size = 18),  
        legend.title = element_text(size = 20)) +
  xlim(c(0, 150)) +
  ylim(c(-0.2, 0.5)) +
  guides(color = guide_legend(override.aes = list(linetype = c("solid", "dashed"))))

# Adding the label
gdp1 <- gdp1 +
  annotate("text", x = 64.3, y = 0.455, 
           label = expression("US"), size = 6) +
  annotate("text", x = 64.3, y = 0.235, 
           label = expression("US"), size = 6)
gdp1
# Save the plot as a JPEG image
#ggsave(filename = "GDP.jpg", plot = gdp1, device = "jpg", width = 12, height = 12)
```

#R&D_investment drawing
```{r}  
combined_data3 <- rbind(
  transform(rddata, source = "PS2014", value = ps2014),
  transform(rddata, source = "PSA001", value = percentage_sample)
)
# Create the plot
RD1 <- ggplot(combined_data3, aes(x = R_D, y = value, color = source)) +
  
 geom_point(size = 6, alpha = 0.6) +
  geom_smooth(method ="lm",size = 2) +
  scale_color_brewer(palette = 'Set1') +
scale_color_manual(name = "Data source", 
                    values = c("#377EB8","#E41A1C"), 
                    labels = c("Traditional studies", "Big team science"))+
  ylab("Proportion of sample") +
  xlab("Research expenditure as a share of GDP") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1,
        legend.position = "right", 
        legend.text = element_text(size = 18),  
        legend.title = element_text(size = 20)) +
  xlim(c(0, 3.5)) +
  ylim(c(-0.14, 0.5)) +
  guides(color = guide_legend(override.aes = list(linetype = c("solid", "dashed"))))

# Adding the label
RD1 <- RD1 +
  annotate("text", x = 2.55, y = 0.455, 
           label = expression("US"), size = 6) +
  annotate("text", x = 2.55, y = 0.235, 
           label = expression("US"), size = 6)

# Print the plot
RD1

# Save the plot as a JPEG image
#ggsave(filename = "RD.jpg", plot = RD1, device = "jpg", width = 12, height = 12)
```

##number_of_universities_per_capita drawing
```{r}
combined_data1 <- rbind(
  transform(universitydata, source = "PS2014", value = ps2014),
  transform(universitydata, source = "PSA001", value = percentage_sample)
)
# Create the plot
university <- ggplot(combined_data1, aes(x = number_of_universities_per_capita, y = value, color = source)) +
  
 geom_point(size = 6, alpha = 0.6) +
  geom_smooth(method ="lm",size = 2) +
  scale_color_brewer(palette = 'Set1') +
 scale_color_manual(name = "Data source", 
                    values = c("#377EB8","#E41A1C"), 
                    labels = c("Traditional studies", "Big team science")) +

  ylab("Proportion of sample") +
  xlab("Number of universities per 100000 people") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1,
        legend.position = "right",  
        legend.text = element_text(size = 18),  
        legend.title = element_text(size = 20)) +
  xlim(c(0, 54)) +
  ylim(c(-0.10, 0.5)) +
  guides(color = guide_legend(override.aes = list(linetype = c("solid", "dashed"))))

# Adding the label
university <- university +
  annotate("text", x = 5, y = 0.455, 
           label = expression("US"), size = 6) +
  annotate("text", x = 5, y = 0.235, 
           label = expression("US"), size = 6)
# Print the plot
university
# Save the plot as a JPEG image
#ggsave(filename = "university.jpg", plot = university, device = "jpg", width = 12, height = 12)
```

##number_of_psychology_researchers_per_capita drawing
```{r}
combined_data1 <- rbind(
  transform(researcherdata, source = "PS2014", value = ps2014),
  transform(researcherdata, source = "PSA001", value = percentage_sample)
)
# Create the plot
researcher <- ggplot(combined_data1, aes(x = number_of_psychology_researchers_per_capita, y = value, color = source)) +
  
 geom_point(size = 6, alpha = 0.6) +
  geom_smooth(method ="lm",size = 2) +
  scale_color_brewer(palette = 'Set1') +
 scale_color_manual(name = "Data source", 
                    values = c("#377EB8","#E41A1C"), 
                    labels = c("Traditional studies", "Big team science")) +

  ylab("Proportion of sample") +
  xlab("Number of psychology researchers per 100000 people") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1,
        legend.position = "right",  
        legend.text = element_text(size = 18),  
        legend.title = element_text(size = 20)) +
  xlim(c(0, 200)) +
  ylim(c(-0.14, 0.5)) +
  guides(color = guide_legend(override.aes = list(linetype = c("solid", "dashed"))))

# Adding the label
researcher <- researcher +
  annotate("text", x = 50, y = 0.455, 
           label = expression("US"), size = 6) +
  annotate("text", x = 50, y = 0.235, 
           label = expression("US"), size = 6)
# Print the plot
researcher
# Save the plot as a JPEG image
ggsave(filename = "researcher.jpg", plot = researcher, device = "jpg", width = 12, height = 12)
```

##average_years_of_schooling drawing
```{r}  
combined_data9 <- rbind(
  transform(edudata, source = "PS2014", value = ps2014),
  transform(edudata, source = "PSA001", value = percentage_sample)
)
# Create the plot
education1 <- ggplot(combined_data9, aes(x = average_years_of_schooling, y = value, color = source)) +
  
 geom_point(size = 6, alpha = 0.6) +
  geom_smooth(method ="lm",size = 2) +
  scale_color_brewer(palette = 'Set1') +
 scale_color_manual(name = "Data source", 
                    values = c("#377EB8","#E41A1C"), 
                    labels = c("Traditional studies", "Big team science"))+
    
  ylab("Proportion of sample") +
  xlab("Average years of formal education\nfor individuals aged 15-64") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1,
        legend.position = "right", 
        legend.text = element_text(size = 18), 
        legend.title = element_text(size = 20)) +
  xlim(c(0, 15)) +
  ylim(c(-0.25, 0.5)) +
  guides(color = guide_legend(override.aes = list(linetype = c("solid", "dashed"))))

# Adding the annotations
education1 <- education1 +
  annotate("text", x = 12.1, y = 0.455, 
           label = expression("US"), size = 6) +
  annotate("text", x = 12.1, y = 0.235, 
           label = expression("US"), size = 6)

# Print the plot
education1

# Save the plot as a JPEG image
#ggsave(filename = "education.jpg", plot = education1, device = "jpg", width = 12, height = 12)
```

##Urbanization drawing
```{r}  
combined_data8 <- rbind(
  transform(urbandata, source = "PS2014", value = ps2014),
  transform(urbandata, source = "PSA001", value = percentage_sample)
)
# Create the plot
UP1 <- ggplot(combined_data8, aes(x = Urbanization, y = value, color = source)) +
  
 geom_point(size = 6, alpha = 0.6) +
  geom_smooth(method ="lm",size = 2) +
  scale_color_brewer(palette = 'Set1') +
 scale_color_manual(name = "Data source", 
                    values = c("#377EB8","#E41A1C"), 
                    labels = c("Traditional studies", "Big team science"))+
    
  ylab("Proportion of sample") +
  xlab("Proportion of urban population") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1,
        legend.position = "right",  
        legend.text = element_text(size = 18),  
        legend.title = element_text(size = 20)) +
  xlim(c(0, 100)) +
  ylim(c(-0.25, 0.5)) +
  guides(color = guide_legend(override.aes = list(linetype = c("solid", "dashed"))))

# Adding the annotations
UP1 <- UP1 +
  annotate("text", x = 75, y = 0.455, 
           label = expression("US"), size = 6) +
  annotate("text", x = 75, y = 0.235, 
           label = expression("US"), size = 6)

# Print the plot
UP1

# Save the plot as a JPEG image
#ggsave(filename = "UP.jpg", plot = UP1, device = "jpg", width = 12, height = 12)
```

##Globalization_Index drawing
```{r}  
combined_data4 <- rbind(
  transform(gidata, source = "PS2014", value = ps2014),
  transform(gidata, source = "PSA001", value = percentage_sample)
)
# Create the plot
GI1 <- ggplot(combined_data4, aes(x = GI, y = value, color = source)) +
 geom_point(size = 6, alpha = 0.6) +
  geom_smooth(method ="lm",size = 2) +
  scale_color_brewer(palette = 'Set1') +
 scale_color_manual(name = "Data source", 
                    values = c("#377EB8","#E41A1C"), 
                    labels = c("Traditional studies", "Big team science"))+
  ylab("Proportion of sample") +
  xlab("Globalization Index") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1,
        legend.position = "right", 
        legend.text = element_text(size = 18),  
        legend.title = element_text(size = 20)) +
  xlim(c(0, 100)) +
  ylim(c(-0.15, 0.5)) +
  guides(color = guide_legend(override.aes = list(linetype = c("solid", "dashed"))))

# Adding the annotations
GI1 <- GI1 +
  annotate("text", x = 73.8, y = 0.455, 
           label = expression("US"), size = 6) +
  annotate("text", x = 73.8, y = 0.235, 
           label = expression("US"), size = 6)
# Print the plot
GI1

# Save the plot as a JPEG image
#ggsave(filename = "GI.jpg", plot = GI1, device = "jpg", width = 12, height = 12)
```

##Internet penetration rate drawing
```{r}  
combined_data5 <- rbind(
  transform(networkdata, source = "PS2014", value = ps2014),
  transform(networkdata, source = "PSA001", value = percentage_sample)
)
# Create the plot
Network1 <- ggplot(combined_data5, aes(x = Network_2021, y = value, color = source)) +
  
 geom_point(size = 6, alpha = 0.6) +
  geom_smooth(method ="lm",size = 2) +
  scale_color_brewer(palette = 'Set1') +
 scale_color_manual(name = "Data source", 
                    values = c("#377EB8","#E41A1C"), 
                    labels = c("Traditional studies", "Big team science"))+
  
  ylab("Proportion of sample") +
  xlab("Proportion of population using the internet") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1,
        legend.position = "right",  
        legend.text = element_text(size = 18),  
        legend.title = element_text(size = 20)) +
  xlim(c(0, 100)) +
  ylim(c(-0.18, 0.5)) +
  guides(color = guide_legend(override.aes = list(linetype = c("solid", "dashed"))))

# Adding the annotations
Network1 <- Network1 +
  annotate("text", x = 84.3, y = 0.455, 
           label = expression("US"), size = 6) +
  annotate("text", x = 84.3, y = 0.235, 
           label = expression("US"), size = 6)

Network1

# Save the plot as a JPEG image
# ggsave(filename = "Network.jpg", plot = Network1, device = "jpg", width = 12, height = 12)
```

##cultural distance drawing
```{r}
combined_data1 <- rbind(
  transform(pddata, source = "PS2014", value = ps2014),
  transform(pddata, source = "PSA001", value = percentage_sample)
)
# Create the plot
pd1 <- ggplot(combined_data1, aes(x = pd, y = value, color = source)) +
  
 geom_point(size = 6, alpha = 0.6) +
  geom_smooth(method ="lm",size = 2) +
  scale_color_brewer(palette = 'Set1') +
 scale_color_manual(name = "Data source", 
                    values = c("#377EB8","#E41A1C"), 
                    labels = c("Traditional studies", "Big team science")) +

  ylab("Proportion of sample") +
  xlab("Culture distance from United States") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1,
        legend.position = "right",  
        legend.text = element_text(size = 18),  
        legend.title = element_text(size = 20)) +
  xlim(c(0, 0.20)) +
  ylim(c(-0.30, 0.5)) +
  guides(color = guide_legend(override.aes = list(linetype = c("solid", "dashed"))))

# Adding the label
pd1 <- pd1 +
  annotate("text", x = 0.018, y = 0.455, 
           label = expression("US"), size = 6) +
  annotate("text", x = 0.018, y = 0.235, 
           label = expression("US"), size = 6)
#turn over X-axis
pd1 <- pd1 + scale_x_reverse()
# Print the plot
pd1

# Save the plot as a JPEG image
# ggsave(filename = "PD.jpg", plot = pd1, device = "jpg", width = 12, height = 12)
```

##Linguistic_distance_1 drawing
```{r}
combined_data6 <- rbind(
  transform(lddata, source = "PS2014", value = ps2014),
  transform(lddata, source = "PSA001", value = percentage_sample)
)
# Create the plot
ld1 <- ggplot(combined_data6, aes(x = lp1, y = value, color = source)) +
  
 geom_point(size = 6, alpha = 0.6) +
  geom_smooth(method ="lm",size = 2) +
  scale_color_brewer(palette = 'Set1') +
scale_color_manual(name = "Data source", 
                    values = c("#377EB8","#E41A1C"), 
                    labels = c("Traditional studies", "Big team science"))+
  ylab("Proportion of sample") +
  xlab("Linguistic distance from United States\n(from English)") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1,
        legend.position = "right",  
        legend.text = element_text(size = 18),  
        legend.title = element_text(size = 20)) +
  xlim(c(0, 3.5)) +
  ylim(c(-0.25, 0.5)) +
  guides(color = guide_legend(override.aes = list(linetype = c("solid", "dashed"))))

# Adding the label
ld1 <- ld1 +
  annotate("text", x = 0.28, y = 0.455, 
           label = expression("US"), size = 6) +
  annotate("text", x = 0.28, y = 0.235, 
           label = expression("US"), size = 6)

# turn over X-axis
ld1 <- ld1 + scale_x_reverse()
# Print the plot
ld1

# Save the plot as a JPEG image
#ggsave(filename = "LD.jpg", plot = ld1, device = "jpg", width = 12, height = 12)
```

##English Proficiency Index rank drawing
```{r}  
combined_data7 <- rbind(
  transform(englishdata, source = "PS2014", value = ps2014),
  transform(englishdata, source = "PSA001", value = percentage_sample)
)
# Create the plot
EPI1 <- ggplot(combined_data7, aes(x = EPI_rank, y = value, color = source)) +
  
 geom_point(size = 6, alpha = 0.6) +
  geom_smooth(method ="lm",size = 2) +
  scale_color_brewer(palette = 'Set1') +
 scale_color_manual(name = "Data source", 
                    values = c("#377EB8","#E41A1C"), 
                    labels = c("Traditional studies", "Big team science"))+
    
  ylab("Proportion of sample") +
  xlab("English Proficiency Index") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1,
        legend.position = "right",  # è®¾ç½®å¾ä¾ä½ç½®ä¸ºé¡¶é¨
        legend.text = element_text(size = 18),  # è®¾ç½®å¾ä¾ææ¬å­ä½å¤§å°
        legend.title = element_text(size = 20)) +
  xlim(c(0, 120)) +
  ylim(c(-0.25, 0.5)) +
  guides(color = guide_legend(override.aes = list(linetype = c("solid", "dashed"))))

# Adding the annotations
EPI1 <- EPI1 +
  annotate("text", x = 11.5, y = 0.455, 
           label = expression("US"), size = 6) +
  annotate("text", x = 11.5, y = 0.235, 
           label = expression("US"), size = 6)

# turn over X-axis
EPI1 <- EPI1 + scale_x_reverse()
# Print the plot
EPI1

# Save the plot as a JPEG image
# ggsave(filename = "EPI.jpg", plot = EPI1, device = "jpg", width = 12, height = 12)
```

##Merge the figures
```{r}  
# Arrange 11 graphics horizontally, left and right
combined_plot1 <- gdp1+ RD1+university+  researcher+education1+UP1+GI1+ Network1 + pd1+ld1+EPI1 + 
  patchwork::plot_layout(ncol = 3) + 
patchwork::plot_annotation(tag_levels ="A",
                  theme = theme(plot.title = element_text(size = 26)))

# Save the plot as a PDF image
ggsave(filename = "Exploratory_analyses.pdf", plot = combined_plot1, device = "pdf", width = 24, height = 20)
```

######_2.Relation between the proportion of each stateâs/provinceâs sample in big team science (using Ruggeri et al. (2022) as an example) and Urbanization/Internet penetration rate/English Proficiency in Kenya/Nigeria, China, and United States/Netherlands. 

##2.1_Urbanization 
##2.1.1_KE_urbanization
```{r}
KE_urbanization <- read_csv("KE_urbanization.csv")
KE_urbanization
```


```{r}
KE_urbanization_model_beta_zi <- brms::brm(
  bf(Ruggeri_KE| trials(total_KE) ~ KE_UP_2020,
     phi ~ KE_UP_2020,
     zi ~ KE_UP_2020),
  data = KE_urbanization,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  backend = "cmdstanr",
  file = "KE_urbanization_model_beta_zi "
)
tidy(KE_urbanization_model_beta_zi, effects = "fixed")
```


```{r}
ame_beta_zi_KE_urbanization <- KE_urbanization_model_beta_zi %>%
  marginaleffects::avg_comparisons(variables = "KE_UP_2020") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_KE_urbanization %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_KE_urbanization, "draw>0")
result

ggplot(ame_beta_zi_KE_urbanization, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of KE_urbanization", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##2.1.2_CN_urbanization
```{r}
CN_urbanization <- read_csv("CN_urbanization.csv")
CN_urbanization
```


```{r}
CN_urbanization_model_beta_zi <- brms::brm(
  bf(Ruggeri_CN| trials(total_CN) ~ CN_UP_2020,
     phi ~ CN_UP_2020,
     zi ~ CN_UP_2020),
  data = CN_urbanization,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  backend = "cmdstanr",
  file = "CN_urbanization_model_beta_zi "
)
tidy(CN_urbanization_model_beta_zi, effects = "fixed")

```

```{r}
ame_beta_zi_CN_urbanization <- CN_urbanization_model_beta_zi %>%
  marginaleffects::avg_comparisons(variables = "CN_UP_2020") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_CN_urbanization %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_CN_urbanization, "draw>0")
result

ggplot(ame_beta_zi_CN_urbanization, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of CN_urbanization", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##2.1.3_US_urbanization
```{r}
US_urbanization <- read_csv("US_urbanization.csv")
US_urbanization
```

```{r}
US_urbanization_model_beta_zi <- brms::brm(
  bf(Ruggeri_US| trials(total_US) ~ US_UP_2020,
   phi ~ US_UP_2020,
     zi ~ US_UP_2020),
  data = US_urbanization,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 4, seed = 1234,
  backend = "cmdstanr",
  file = "US_urbanization_model_beta_zi "
)
tidy(US_urbanization_model_beta_zi, effects = "fixed")

```


```{r}
ame_beta_zi_US_urbanization <- US_urbanization_model_beta_zi %>%
  marginaleffects::avg_comparisons(variables = "US_UP_2020") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_US_urbanization %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_US_urbanization, "draw>0")
result

ggplot(ame_beta_zi_US_urbanization, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of US_urbanization", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##2.2_Internet penetration rate
##2.2.1_NG_internet
```{r}
NG_internet <- read_csv("NG_internet.csv")
NG_internet
```

```{r}
NG_internet_model_beta_zi <- brms::brm(
  bf(Ruggeri_NG| trials(total_NG) ~ Internet_NG_2022,
     phi ~ Internet_NG_2022,
     zi ~ Internet_NG_2022),
  data = NG_internet,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  backend = "cmdstanr",
  file = "NG_internet_model_beta_zi "
)
tidy(NG_internet_model_beta_zi, effects = "fixed")

```

```{r}
ame_beta_zi_NG_internet <- NG_internet_model_beta_zi %>%
  marginaleffects::avg_comparisons(variables = "Internet_NG_2022") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_NG_internet %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_NG_internet, "draw<0")
result

ggplot(ame_beta_zi_NG_internet, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of NG_internet", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##2.2.2_CN_internet
```{r}
CN_internet <- read_csv("CN_internet.csv")
CN_internet
```

```{r}
CN_internet_model_beta_zi <- brms::brm(
  bf(Ruggeri_CN| trials(total_CN) ~ Internet_CN_2016,
     phi ~ Internet_CN_2016,
     zi ~ Internet_CN_2016),
  data = CN_internet,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  
  backend = "cmdstanr",
  file = "CN_internet_model_beta_zi "
)
tidy(CN_internet_model_beta_zi, effects = "fixed")

```

```{r}
ame_beta_zi_CN_internet <- CN_internet_model_beta_zi %>%
  marginaleffects::avg_comparisons(variables = "Internet_CN_2016") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_CN_internet %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_CN_internet, "draw>0")
result

ggplot(ame_beta_zi_CN_internet, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of CN_internet", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##2.2.3_US_internet
```{r}
US_internet <- read_csv("US_internet.csv")
US_internet
```

```{r}
US_internet_model_beta_zi <- brms::brm(
  bf(Ruggeri_US| trials(total_US) ~ Internet_US_2018,
     phi ~ Internet_US_2018,
     zi ~ Internet_US_2018),
  data = US_internet,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  backend = "cmdstanr",
  file = "US_internet_model_beta_zi "
)
tidy(US_internet_model_beta_zi, effects = "fixed")
```

```{r}
ame_beta_zi_US_internet <- US_internet_model_beta_zi %>%
  marginaleffects::avg_comparisons(variables = "Internet_US_2018") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_US_internet %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_US_internet, "draw>0")
result

ggplot(ame_beta_zi_US_internet, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of US_internet", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```
##2.3_English Proficiency
##2.3.1_NG_EPI
```{r}
NG_EPI <- read_csv("NG_EPI.csv")
NG_EPI
```

```{r}
NG_EPI_model_beta_zi <- brms::brm(
  bf(Ruggeri_NG| trials(total_NG) ~ EPI_NG_2022,
     phi ~ EPI_NG_2022,
     zi ~ EPI_NG_2022),
  data = NG_EPI,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  backend = "cmdstanr",
  file = "NG_EPI_model_beta_zi "
)
tidy(NG_EPI_model_beta_zi, effects = "fixed")
```

```{r}
ame_beta_zi_NG_EPI <- NG_EPI_model_beta_zi %>%
  marginaleffects::avg_comparisons(variables = "EPI_NG_2022") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_NG_EPI %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_NG_EPI, "draw<0")
result

ggplot(ame_beta_zi_NG_EPI, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of NG_EPI", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##2.3.2_CN_EPI
```{r}
CN_EPI <- read_csv("CN_EPI.csv")
CN_EPI
```

```{r}
CN_EPI_model_beta_zi <- brms::brm(
  bf(Ruggeri_CN| trials(total_CN) ~ EPI_CN_2022,
     phi ~ EPI_CN_2022,
     zi ~ EPI_CN_2022),
  data = CN_EPI,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  backend = "cmdstanr",
  file = "CN_EPI_model_beta_zi"
)
tidy(CN_EPI_model_beta_zi, effects = "fixed")
```

```{r}
ame_beta_zi_CN_EPI <- CN_EPI_model_beta_zi %>%
  marginaleffects::avg_comparisons(variables = "EPI_CN_2022") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_CN_EPI %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_CN_EPI, "draw<0")
result

ggplot(ame_beta_zi_CN_EPI, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of CN_EPI", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```

##2.3.3_NL_EPI
```{r}
NL_EPI <- read_csv("NL_EPI.csv")
NL_EPI
```

```{r}
NL_EPI_model_beta_zi <- brms::brm(
  bf(Ruggeri_NL| trials(total_NL) ~ EPI_NL_2022,
     phi ~ EPI_NL_2022,
     zi ~ EPI_NL_2022),
  data = NL_EPI,
  family = zero_inflated_beta_binomial(),
  chains = 4, iter = 2000, warmup = 1000,
  cores = 2, seed = 1234,
  backend = "cmdstanr",
  file = "NL_EPI_model_beta_zi "
)
tidy(NL_EPI_model_beta_zi, effects = "fixed")
```

```{r}
ame_beta_zi_NL_EPI <- NL_EPI_model_beta_zi %>%
  marginaleffects::avg_comparisons(variables = "EPI_NL_2022") %>% 
  marginaleffects::posterior_draws()
ame_beta_zi_NL_EPI %>% tidybayes::median_hdi(draw)
result <- brms::hypothesis(ame_beta_zi_NL_EPI, "draw>0")
result

ggplot(ame_beta_zi_NL_EPI, aes(x = draw)) +
  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",
               fill = "#bc3032") +
  scale_x_continuous(labels = label_pp) +
  labs(x = "Average marginal effect of NL_EPI", y = NULL,
       caption = "80% and 95% credible intervals shown in black") +
  theme_clean()
```


### Mapping Urbanization by state/province in Kenya, China, and the United States

##Kenya drawing (Urbanization)
```{r}  
model <- lm(Ruggeri_KE_pro ~ KE_UP_2020, data = KE_urbanization)
predict_data_KE <- data.frame(KE_UP_2020 = KE_urbanization$KE_UP_2020, Ruggeri_KE_pro = KE_urbanization$Ruggeri_KE_pro )
predict_data_KE$predicted <- predict(model, newdata = predict_data_KE)
predict_data_KE$lower <- predict(model, newdata = KE_urbanization, interval = "confidence")[, "lwr"]
predict_data_KE$upper <- predict(model, newdata = KE_urbanization, interval = "confidence")[, "upr"]

KE_UP <- ggplot(data = KE_urbanization, aes(y = Ruggeri_KE_pro, x = KE_UP_2020, color = "#E41A1C")) +
  geom_point(stat = "identity", position = "identity", size = 6) +
  geom_line(data = predict_data_KE, aes(y = predicted), color = "#E41A1C", size = 2) +
  geom_ribbon(data = predict_data_KE, aes(ymin = lower, ymax = upper), fill = "black", alpha = 0.3, linetype = "blank") +
  ylab("Proportion of sample in big team science") +
  xlab("Proportion of urban population\nby province in Kenya") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1) +
  xlim(c(0, 1)) +
  ylim(c(-0.23, 0.9)) +
  guides(color = FALSE)

KE_UP 
# Save the plot as a pdf image
#ggsave(filename = " KE_UP.pdf", plot = KE_UP, device = "jpg", width = 12, height = 12)
```


##China drawing (Urbanization)
```{r}  
model <- lm(Ruggeri_CN_pro ~ CN_UP_2020, data = CN_urbanization)
predict_data_CN <- data.frame(CN_UP_2020= CN_urbanization$CN_UP_2020, Ruggeri_CN_pro = CN_urbanization$Ruggeri_CN_pro )
predict_data_CN$predicted <- predict(model, newdata = predict_data_CN)
predict_data_CN$lower <- predict(model, newdata = CN_urbanization, interval = "confidence")[, "lwr"]
predict_data_CN$upper <- predict(model, newdata = CN_urbanization, interval = "confidence")[, "upr"]

CN_UP <- ggplot(data = CN_urbanization, aes(y = Ruggeri_CN_pro, x = CN_UP_2020, color = "#E41A1C")) +
  geom_point(stat = "identity", position = "identity", size = 6) +
  geom_line(data = predict_data_CN, aes(y = predicted), color = "#E41A1C", size = 2) +
  geom_ribbon(data = predict_data_CN, aes(ymin = lower, ymax = upper), fill = "black", alpha = 0.3, linetype = "blank") +
  ylab("Proportion of sample in big team science") +
  xlab("Proportion of urban population\nby province in China") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1) +
  xlim(c(0, 1)) +
  ylim(c(-0.03, 0.2)) +
  guides(color = FALSE)

CN_UP 
# Save the plot as a pdf image
# ggsave(filename = "CN_UP.jpg", plot = CN_UP, device = "pdf", width = 12, height = 12)
```

##the United States drawing (Urbanization)
```{r}  
model <- lm(Ruggeri_US_pro ~ US_UP_2020, data = US_urbanization)
predict_data_US <- data.frame(US_UP_2020= US_urbanization$US_UP_2020, Ruggeri_US_pro = US_urbanization$Ruggeri_US_pro )
predict_data_US$predicted <- predict(model, newdata = predict_data_US)
predict_data_US$lower <- predict(model, newdata = US_urbanization, interval = "confidence")[, "lwr"]
predict_data_US$upper <- predict(model, newdata = US_urbanization, interval = "confidence")[, "upr"]

US_UP <- ggplot(data = US_urbanization, aes(y = Ruggeri_US_pro, x = US_UP_2020, color = "#E41A1C")) +
  geom_point(stat = "identity", position = "identity", size = 6) +
  geom_line(data = predict_data_US, aes(y = predicted), color = "#E41A1C", size = 2) +
  geom_ribbon(data = predict_data_US, aes(ymin = lower, ymax = upper), fill = "black", alpha = 0.3, linetype = "blank") +
  ylab("Proportion of sample in big team science") +
  xlab("Proportion of urban population\nby state in United States") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1) +
  xlim(c(0, 1)) +
  ylim(c(-0.036, 0.2)) +
  guides(color = FALSE)

US_UP 
# Save the plot as a pdf image
# ggsave(filename = " US_UP.jpg", plot = US_UP, device = "pdf", width = 12, height = 12)
```

### Mapping Internet penetration rate by state/province in Nigeria, China, and the United States

##Nigeria drawing (Internet penetration rate)
```{r}  
# æåçº¿æ§åå½æ¨¡åå¹¶è®¡ç®ç½®ä¿¡åºé´
model <- lm(Ruggeri_NG_pro ~ Internet_NG_2022, data = NG_internet)
predict_data_NG <- data.frame(Internet_NG_2022 = NG_internet$Internet_NG_2022, Ruggeri_NG_pro = NG_internet$Ruggeri_NG_pro )
predict_data_NG$predicted <- predict(model, newdata = predict_data_NG)
predict_data_NG$lower <- predict(model, newdata = NG_internet, interval = "confidence")[, "lwr"]
predict_data_NG$upper <- predict(model, newdata = NG_internet, interval = "confidence")[, "upr"]

# ç»å¶æ£ç¹å¾ååå½çº¿
NG_IPR <- ggplot(data = NG_internet, aes(y = Ruggeri_NG_pro, x = Internet_NG_2022, color = "#E41A1C")) +
  geom_point(stat = "identity", position = "identity", size = 6) +
  geom_line(data = predict_data_NG, aes(y = predicted), color = "#E41A1C", size = 2) +
  geom_ribbon(data = predict_data_NG, aes(ymin = lower, ymax = upper), fill = "black", alpha = 0.3, linetype = "blank") +
  ylab("Proportion of sample in big team science") +
  xlab("Proportion of active Internet\nby state in Nigeria") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1) +
  xlim(c(0, 3)) +
  ylim(c(-0.18, 0.7)) +
  guides(color = FALSE)

NG_IPR
# Save the plot as a JPEG image
ggsave(filename = "NG_IPR.jpg", plot = NG_IPR, device = "jpg", width = 12, height = 12)
```

##China drawing (Internet penetration rate)
```{r}  
# æåçº¿æ§åå½æ¨¡åå¹¶è®¡ç®ç½®ä¿¡åºé´
model <- lm(Ruggeri_CN_pro ~ Internet_CN_2016, data = CN_internet)
predict_data_CN <- data.frame(Internet_CN_2016= CN_internet$Internet_CN_2016, Ruggeri_CN_pro = CN_internet$Ruggeri_CN_pro )
predict_data_CN$predicted <- predict(model, newdata = predict_data_CN)
predict_data_CN$lower <- predict(model, newdata = CN_internet, interval = "confidence")[, "lwr"]
predict_data_CN$upper <- predict(model, newdata = CN_internet, interval = "confidence")[, "upr"]

# ç»å¶æ£ç¹å¾ååå½çº¿
CN_IPR <- ggplot(data = CN_internet, aes(y = Ruggeri_CN_pro, x = Internet_CN_2016, color = "#E41A1C")) +
  geom_point(stat = "identity", position = "identity", size = 6) +
  geom_line(data = predict_data_CN, aes(y = predicted), color = "#E41A1C", size = 2) +
  geom_ribbon(data = predict_data_CN, aes(ymin = lower, ymax = upper), fill = "black", alpha = 0.3, linetype = "blank") +
  ylab("Proportion of sample in big team science") +
  xlab("Proportion of population using the internet\nby province in china") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1) +
  xlim(c(0.38, 1)) +
  ylim(c(-0.03, 0.3)) +
  guides(color = FALSE)

CN_IPR
# Save the plot as a JPEG image
#ggsave(filename = "CN_IPR.jpg", plot = CN_IPR, device = "jpg", width = 12, height = 12)
```

##the United States drawing (Internet penetration rate)
```{r}  
model <- lm(Ruggeri_US_pro ~ Internet_US_2018, data = US_internet)
predict_data_US <- data.frame(Internet_US_2018= US_internet$Internet_US_2018, Ruggeri_US_pro = US_internet$Ruggeri_US_pro )
predict_data_US$predicted <- predict(model, newdata = predict_data_US)
predict_data_US$lower <- predict(model, newdata = US_internet, interval = "confidence")[, "lwr"]
predict_data_US$upper <- predict(model, newdata = US_internet, interval = "confidence")[, "upr"]

US_IPR <- ggplot(data = US_internet, aes(y = Ruggeri_US_pro, x = Internet_US_2018, color = "#E41A1C")) +
  geom_point(stat = "identity", position = "identity", size = 6) +
  geom_line(data = predict_data_US, aes(y = predicted), color = "#E41A1C", size = 2) +
  geom_ribbon(data = predict_data_US, aes(ymin = lower, ymax = upper), fill = "black", alpha = 0.3, linetype = "blank") +
  ylab("Proportion of sample in big team science") +
  xlab("Proportion of population using the internet\nby state in United States") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1) +
  xlim(c(0.38, 1)) +
  ylim(c(-0.03, 0.2)) +
  guides(color = FALSE)

US_IPR
# Save the plot as a JPEG image
#ggsave(filename = "US_IPR.jpg", plot = US_IPR, device = "jpg", width = 12, height = 12)
```


### Mapping English Proficiency by state/province in Nigeria, China, and Netherlands

##Nigeria drawing (English Proficiency)
```{r}  
model <- lm(Ruggeri_NG_pro ~ EPI_NG_2022, data = NG_EPI)
predict_data_NG <- data.frame(EPI_NG_2022 = NG_EPI$EPI_NG_2022, Ruggeri_NG_pro = NG_EPI$Ruggeri_NG_pro )

predict_data_NG$predicted <- predict(model, newdata = predict_data_NG)
predict_data_NG$lower <- predict(model, newdata = NG_EPI, interval = "confidence")[, "lwr"]
predict_data_NG$upper <- predict(model, newdata = NG_EPI, interval = "confidence")[, "upr"]

NG_EPI <- ggplot(data = NG_EPI, aes(y = Ruggeri_NG_pro, x = EPI_NG_2022, color = "#E41A1C")) +
  geom_point(stat = "identity", position = "identity", size = 6) +
  geom_line(data = predict_data_NG, aes(y = predicted), color = "#E41A1C", size = 2) +
  geom_ribbon(data = predict_data_NG, aes(ymin = lower, ymax = upper), fill = "black", alpha = 0.3, linetype = "blank") +
  ylab("Proportion of sample in big team science") +
  xlab("English Proficiency of Nigeria by state") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1) +
  xlim(c(470, 670)) +
  ylim(c(-0.13, 0.67)) +
  guides(color = FALSE)
#turn over X-axis
NG_EPI <- NG_EPI + scale_x_reverse()

NG_EPI 
# Save the plot as a JPEG image
# ggsave(filename = " NG_EPI.jpg", plot = NG_EPI, device = "jpg", width = 12, height = 12)
```

##China drawing (English Proficiency)
```{r}  
model <- lm(Ruggeri_CN_pro ~ EPI_CN_2022, data = CN_EPI)
predict_data_CN <- data.frame(EPI_CN_2022 = CN_EPI$EPI_CN_2022, Ruggeri_CN_pro = CN_EPI$Ruggeri_CN_pro )
predict_data_CN$predicted <- predict(model, newdata = predict_data_CN)
predict_data_CN$lower <- predict(model, newdata = CN_EPI, interval = "confidence")[, "lwr"]
predict_data_CN$upper <- predict(model, newdata = CN_EPI, interval = "confidence")[, "upr"]

CN_EPI <- ggplot(data = CN_EPI, aes(y = Ruggeri_CN_pro, x = EPI_CN_2022, color = "#E41A1C")) +
  geom_point(stat = "identity", position = "identity", size = 6) +
  geom_line(data = predict_data_CN, aes(y = predicted), color = "#E41A1C", size = 2) +
  geom_ribbon(data = predict_data_CN, aes(ymin = lower, ymax = upper), fill = "black", alpha = 0.3, linetype = "blank") +
  ylab("Proportion of sample in big team science") +
  xlab("English Proficiency of China by province") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1) +
  xlim(c(0, 32)) +
  ylim(c(-0.13, 0.67)) +
  guides(color = FALSE)

#turn over X-axis
CN_EPI <- CN_EPI + scale_x_reverse()

CN_EPI 
# Save the plot as a JPEG image
ggsave(filename = " CN_EPI.jpg", plot = CN_EPI, device = "jpg", width = 12, height = 12)
```

##Netherlands drawing (English Proficiency)
```{r}  

model <- lm(Ruggeri_NL_pro ~ EPI_NL_2022, data = NL_EPI)
predict_data_NL <- data.frame(EPI_NL_2022 = NL_EPI$EPI_NL_2022, Ruggeri_NL_pro = NL_EPI$Ruggeri_NL_pro )
predict_data_NL$predicted <- predict(model, newdata = predict_data_NL)
predict_data_NL$lower <- predict(model, newdata = NL_EPI, interval = "confidence")[, "lwr"]
predict_data_NL$upper <- predict(model, newdata = NL_EPI, interval = "confidence")[, "upr"]

NL_EPI <- ggplot(data = NL_EPI, aes(y = Ruggeri_NL_pro, x = EPI_NL_2022, color = "#E41A1C")) +
  geom_point(stat = "identity", position = "identity", size = 6) +
  geom_line(data = predict_data_NL, aes(y = predicted), color = "#E41A1C", size = 2) +
  geom_ribbon(data = predict_data_NL, aes(ymin = lower, ymax = upper), fill = "black", alpha = 0.3, linetype = "blank") +
  ylab("Proportion of sample in big team science") +
  xlab("English Proficiency of Netherlands by state") +
  theme(axis.text = element_text(size = 20),
        axis.title = element_text(size = 24),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        aspect.ratio = 1) +
  xlim(c(0, 32)) +
  ylim(c(-0.18, 0.67)) +
  guides(color = FALSE)
#turn over X-axis
NL_EPI <- NL_EPI + scale_x_reverse()

NL_EPI 
# Save the plot as a JPEG image
ggsave(filename = " NL_EPI.jpg", plot = NL_EPI, device = "jpg", width = 12, height = 12)
```



```{r}  
# Arrange 9 graphics horizontally, left and right
combined_plot2 <- KE_UP + CN_UP + US_UP + NG_IPR + CN_IPR + US_IPR + NG_EPI + CN_EPI + NL_EPI+
  patchwork::plot_layout(ncol = 3) + 
patchwork::plot_annotation(tag_levels ="A",
                  theme = theme(plot.title = element_text(size = 26)))

combined_plot2
# Save the plot as a pdf image
ggsave(filename = "Exploratory_analyses_by_state.pdf", plot = combined_plot2, device = "pdf", width = 24, height = 24)
```




## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
